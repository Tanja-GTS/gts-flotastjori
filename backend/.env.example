# Backend
PORT=4000

# API auth (Entra ID)
# If enabled, the frontend must send an access token in Authorization header.
#
# 1) Register an API app in Entra ID (this represents the backend API)
# 2) Expose an API scope (recommended name: access_as_user)
# 3) Configure the SPA app to request that scope
#
# Use a GUID tenant ID for best results (not "organizations").
AUTH_ENABLED=false
ENTRA_TENANT_ID=

# Expected audience in the access token. Usually one of:
# - api://<BACKEND_API_APP_CLIENT_ID>
# - <BACKEND_API_APP_CLIENT_ID>
ENTRA_API_AUDIENCE=

# Required scope (from "scp") or role (from "roles"). Default: access_as_user
ENTRA_REQUIRED_SCOPE=access_as_user

# Microsoft Graph auth
# Option A (recommended for production): app-only client credentials
#   - Set AZURE_CLIENT_SECRET and the backend will use client_credentials
# Option B (easiest for dev, no client secret): Device Code flow
#   - Leave AZURE_CLIENT_SECRET blank and the backend will print a sign-in code
#
# Tenant can be a GUID, a domain, or "organizations".
AZURE_TENANT_ID=organizations
AZURE_CLIENT_ID=
AZURE_CLIENT_SECRET=

# Optional: use a different delegated bearer token for sending email.
# This controls the *From* mailbox when using delegated tokens (/me/sendMail).
# Example: paste a token from Graph Explorer signed in as your fleet manager.
GRAPH_MAIL_BEARER_TOKEN=

# Delegated scopes (Device Code only). Comma or space separated.
# For generating/writing items you'll typically need Sites.ReadWrite.All.
# For sending confirmation emails from the signed-in user, you also need Mail.Send.
GRAPH_SCOPES=https://graph.microsoft.com/Sites.ReadWrite.All https://graph.microsoft.com/Mail.Send offline_access

# Optional: if you use app-only auth (AZURE_CLIENT_SECRET set), /me/sendMail won't work.
# In that case set a real mailbox to send from (UPN/email), and ensure the app has
# application permission Mail.Send with admin consent.
MAIL_SENDER_UPN=

# Optional: base URL for confirmation links in emails.
# If not set, the backend falls back to http://localhost:5174.
# Example (production): https://fleet.yourcompany.com
APP_ORIGIN=

# Optional: make replies go to a fleet manager / generic inbox.
# NOTE: The actual From address is still the mailbox used to send via Graph.
MAIL_REPLY_TO_EMAIL=
MAIL_REPLY_TO_NAME=

# Optional per-workspace override (JSON string): workspaceId -> email/name
# Example:
# WORKSPACE_MANAGER_EMAILS={"south":"fleet.south@company.com","school":"fleet.school@company.com"}
# WORKSPACE_MANAGER_NAMES={"south":"South Fleet","school":"School Fleet"}
WORKSPACE_MANAGER_EMAILS=
WORKSPACE_MANAGER_NAMES=

# Quickstart (no app registration): paste a Graph access token here.
# You can get one from https://aka.ms/ge (Graph Explorer) after signing in.
# Note: tokens expire; you'll need to refresh it periodically.
GRAPH_BEARER_TOKEN=

# Microsoft Lists / SharePoint Site + List IDs
# Site ID format example:
#   contoso.sharepoint.com,<siteCollectionId>,<siteId>
MS_SITE_ID=
MS_SHIFT_PATTERNS_LIST_ID=
MS_SHIFT_INSTANCES_LIST_ID=

# Optional: list IDs referenced by lookup columns
MS_ROUTES_LIST_ID=
MS_TEMPLATES_LIST_ID=
MS_BUSES_LIST_ID=
MS_DRIVERS_LIST_ID=

# Optional: needed to resolve RouteLookupId -> Route Title
MS_ROUTES_LIST_ID=

# Optional: needed to read BusLookupId/DriverLookupId from templates (to satisfy required fields on ShiftInstances)
MS_TEMPLATES_LIST_ID=

# Optional: template column mapping
# Route name is now read primarily from the ShiftTemplates/Templates list.
# Set this if your templates list internal column name is not "routeName".
TEMPLATE_FIELD_ROUTE_NAME=routeName

# Optional: TripsTemplates list (drives the per-shift trips shown in the UI)
# If not set, backend will try to infer a list whose name includes "trip" and "template".
MS_TRIP_TEMPLATES_LIST_ID=

# Optional: StopsTemplate list (drives the per-trip stop timeline / events)
# If not set, backend will try to infer a list whose name includes "stop" and "template".
MS_STOPS_TEMPLATE_LIST_ID=

# Optional: internal column overrides for StopsTemplate
# Defaults (based on your current schema):
#   Trip lookup backing field: TripLookupId
#   Stop name: field_1
#   Time: field_2
STOPSTEMPLATE_FIELD_TRIP_ID=
STOPSTEMPLATE_FIELD_STOP_NAME=
STOPSTEMPLATE_FIELD_TIME=

# Optional (recommended if breaks/ordering are often wrong):
# Add these columns to StopsTemplate so ordering and break/stop type is explicit.
# The backend will try to auto-detect these by SharePoint column *display name*.
# Use the env vars only if your internal field keys are unusual and auto-detect doesn't find them.
# - SortOrder (number): sorts items within a trip
# - EventType (choice/text): "stop" or "break"
# - Duration (number): break duration in minutes
STOPSTEMPLATE_FIELD_SORT_ORDER=
STOPSTEMPLATE_FIELD_EVENT_TYPE=
STOPSTEMPLATE_FIELD_DURATION=

# Optional: cache TTL for SharePoint column metadata lookup (ms)
STOPSTEMPLATE_COLUMNS_CACHE_TTL_MS=300000

# Optional: internal column overrides for TripsTemplates
TRIPTEMPLATE_FIELD_TEMPLATE_ID=
TRIPTEMPLATE_FIELD_NAME=
TRIPTEMPLATE_FIELD_TIME=
TRIPTEMPLATE_FIELD_START=
TRIPTEMPLATE_FIELD_END=
TRIPTEMPLATE_FIELD_BUS_OVERRIDE=
TRIPTEMPLATE_FIELD_EVENTS=

# Cache TTL for trips template list reads (ms)
TRIP_TEMPLATES_CACHE_TTL_MS=30000

# Optional: map List column internal names (defaults exist in code)
# ShiftInstances fields
LIST_FIELD_WORKSPACE_ID=workspaceId
LIST_FIELD_DATE=date
LIST_FIELD_TEMPLATE_ID=templateId
LIST_FIELD_PATTERN_ID=patternId
LIST_FIELD_DRIVER_ID=driverId
LIST_FIELD_BUS_ID=busId
LIST_FIELD_CONFIRMATION_STATUS=confirmationStatus
LIST_FIELD_NOTES=notes
LIST_FIELD_GENERATED=generated
LIST_FIELD_MANUAL_OVERRIDE=manualOverride

# Shift generation defaults
# Your ShiftInstances list may mark busId/templateId required. If busId is required, set this.
DEFAULT_BUS_LOOKUP_ID=

# ShiftPatterns fields
PATTERN_FIELD_ROUTE=route
PATTERN_FIELD_ROUTE_NAME=routeName
PATTERN_FIELD_SHIFT_TYPE=shiftType
# Optional: set this if your list has a column like "ShiftType" with values "weekdays" or "weekend".
# If left blank, the backend will also try common internal names like "ShiftType".
PATTERN_FIELD_WEEK_PART=
PATTERN_FIELD_DAY_OF_WEEK=dayOfWeek
PATTERN_FIELD_START_TIME=startTime
PATTERN_FIELD_END_TIME=endTime

# Optional (only if your ShiftPatterns list has these columns)
PATTERN_FIELD_WORKSPACE_ID=
PATTERN_FIELD_TEMPLATE_ID=
